<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>SQUARE DASH - Official 1.0</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üêü</text></svg>">
    <style>
        :root { --outline: #000; --player-color: #00ffcc; --spike-color: #ff3366; --saw-color: #ffaa00; --victory-gold: #ffd700; }
        body { background: #111; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; color: #fff; font-family: 'Arial Black', sans-serif; overflow: hidden; }
        #game-viewport { width: 95vw; height: 70vh; background-color: #0072ff; border: 6px solid var(--outline); position: relative; overflow: hidden; border-radius: 10px; cursor: pointer; transition: background-color 0.8s ease; }
        #floor { position: absolute; bottom: 0; width: 100%; height: 5px; background: var(--outline); z-index: 11; }
        #player { width: 46px; height: 46px; background: var(--player-color); border: 4px solid var(--outline); position: absolute; bottom: 5px; left: 140px; border-radius: 4px; z-index: 10; }
        #player.victory { background: #fff !important; box-shadow: 0 0 25px #fff; border-color: var(--victory-gold); }
        .spike { width: 0; height: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-bottom: 50px solid var(--outline); position: absolute; z-index: 9; bottom: 5px; }
        .spike::after { content: ''; position: absolute; left: -21px; top: 4px; width: 0; height: 0; border-left: 21px solid transparent; border-right: 21px solid transparent; border-bottom: 42px solid var(--spike-color); }
        .saw { width: 90px; height: 90px; position: absolute; z-index: 8; background: var(--outline); bottom: -35px; clip-path: polygon(50% 0%, 58% 18%, 78% 10%, 75% 30%, 95% 32%, 82% 50%, 95% 68%, 75% 70%, 78% 90%, 58% 82%, 50% 100%, 42% 82%, 22% 90%, 25% 70%, 5% 68%, 18% 50%, 5% 32%, 25% 30%, 22% 10%, 42% 18%); display: flex; align-items: center; justify-content: center; }
        .saw::after { content: ''; width: 64px; height: 64px; background: var(--saw-color); clip-path: inherit; }
        .stat-box { background: #fff; color: #000; padding: 5px 20px; border: 4px solid var(--outline); border-radius: 8px; font-size: 24px; font-weight: 900; min-width: 80px; text-align: center; }
        .stat-box.gold { background: var(--victory-gold); box-shadow: 0 0 15px var(--victory-gold); }
        #victory-banner { position: absolute; top: 15%; width: 100%; text-align: center; font-size: 45px; color: var(--victory-gold); text-shadow: 3px 3px 0 #000; display: none; z-index: 100; pointer-events: none; }
    </style>
</head>
<body>
    <div style="width: 95vw; display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center;">
        <div class="stat-box" id="score">0</div>
        <div style="text-align: center; color: white;">
            <h1 style="margin:0;">SQUARE DASH</h1>
            <div id="sub-title">WYZWANIE 107 ≈öLEDZI</div>
        </div>
        <div class="stat-box" id="highscore">0</div>
    </div>
    <div id="game-viewport">
        <div id="victory-banner">UDOKUMENTOWANO: 107 üêü</div>
        <div id="floor"></div><div id="player"></div>
        <div id="msg" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: #fff; color: #000; padding: 40px; border: 6px solid var(--outline); border-radius: 15px; z-index: 101;">
            <h2>WITAJ W SQUARE DASH</h2><p>DOBIJESZ DO 107?</p>
        </div>
    </div>

    <script>
        const viewport = document.getElementById('game-viewport'), player = document.getElementById('player'), scoreEl = document.getElementById('score'), hsEl = document.getElementById('highscore'), msg = document.getElementById('msg'), banner = document.getElementById('victory-banner'), subTitle = document.getElementById('sub-title');
        let gravity = 1.4, velocity = 0, position = 0, rotation = 0;
        let score = 0, gameSpeed = 15, isGameOver = true, obstacles = [];
        let jumpQueued = false, lastObsX = 0, sawGlobalRotation = 0, minDistance = 550;
        const bgColors = ["#0072ff", "#ff4b2b", "#8e44ad", "#27ae60", "#f39c12", "#34495e"];

        function refreshHS() {
            let hs = parseInt(localStorage.getItem('squareDashHS')) || 0;
            hsEl.innerText = hs;
            if (hs >= 107) {
                hsEl.parentElement.classList.add('gold');
                subTitle.innerText = "MISJA: UDOKUMENTOWANA";
            }
        }
        refreshHS();

        function handleInput(e) {
            if (e.repeat) return;
            if((e.type === 'keydown' && (e.code === 'Space' || e.code === 'ArrowUp')) || e.type === 'mousedown') {
                if (isGameOver) resetGame(); else jumpQueued = true;
            }
        }

        function createObstacle() {
            if (isGameOver) return;
            const spawnX = viewport.offsetWidth + 100;
            if (spawnX - lastObsX < minDistance) { setTimeout(createObstacle, 50); return; }
            const type = (Math.random() > 0.7) ? 'saw' : 'spike';
            const obs = document.createElement('div');
            obs.className = type; obs.style.left = spawnX + 'px';
            viewport.appendChild(obs);
            obstacles.push({element: obs, type: type});
            lastObsX = spawnX;
            setTimeout(createObstacle, 100);
        }

        function update() {
            if (isGameOver) return;
            velocity -= gravity; position += velocity;
            sawGlobalRotation -= (gameSpeed * 1.5);
            if (position <= 0) {
                position = 0; velocity = 0; rotation = Math.round(rotation / 90) * 90;
                if (jumpQueued) { velocity = 24; jumpQueued = false; }
            } else { rotation += 10; }

            const pR = player.getBoundingClientRect();
            lastObsX -= gameSpeed;

            obstacles.forEach((obj, index) => {
                let left = parseFloat(obj.element.style.left) - gameSpeed;
                obj.element.style.left = left + 'px';
                if (obj.type === 'saw') obj.element.style.transform = `rotate(${sawGlobalRotation}deg)`;
                const oR = obj.element.getBoundingClientRect();
                let mX = obj.type === 'saw' ? 28 : 18;
                if (pR.left < oR.right - mX && pR.right > oR.left + mX && pR.top < oR.bottom - 5 && pR.bottom > oR.top + 5) gameOver();
                if (left < -150) { 
                    obj.element.remove(); obstacles.splice(index, 1); 
                    if (score < 107) {
                        score++; scoreEl.innerText = score;
                        if (minDistance > 320) minDistance -= 2; 
                    }
                    if (score === 107) {
                        player.classList.add('victory'); banner.style.display = 'block';
                        scoreEl.style.color = 'var(--victory-gold)';
                    }
                    gameSpeed += 0.04; 
                    if (score % 10 === 0 && score <= 100) viewport.style.backgroundColor = bgColors[(score/10) % bgColors.length];
                }
            });
            player.style.bottom = (position + 5) + 'px';
            player.style.transform = `rotate(${rotation}deg)`;
            requestAnimationFrame(update);
        }

        function gameOver() {
            isGameOver = true; jumpQueued = false; player.style.display = 'none'; banner.style.display = 'none';
            let currentHS = parseInt(localStorage.getItem('squareDashHS')) || 0;
            if (score > currentHS) localStorage.setItem('squareDashHS', Math.min(score, 107));
            refreshHS();
            msg.innerHTML = `<h1>KONIEC GRY</h1><p>TW√ìJ WYNIK: ${score}</p><p>KLIKNIJ BY POWT√ìRZYƒÜ</p>`;
            msg.style.display = 'block';
        }

        function resetGame() {
            document.querySelectorAll('.spike, .saw').forEach(el => el.remove());
            obstacles = []; score = 0; position = 0; gameSpeed = 15; rotation = 0; velocity = 0; jumpQueued = false; lastObsX = 0; minDistance = 550;
            player.classList.remove('victory'); banner.style.display = 'none';
            scoreEl.innerText = '0'; scoreEl.style.color = '#000';
            isGameOver = false; msg.style.display = 'none'; player.style.display = 'block'; viewport.style.backgroundColor = bgColors[0];
            setTimeout(createObstacle, 600); update();
        }
        window.addEventListener('keydown', handleInput); viewport.addEventListener('mousedown', handleInput);
    </script>
</body>
</html>
